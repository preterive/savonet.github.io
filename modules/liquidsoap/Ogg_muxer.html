<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="MFrame.html">
<link rel="next" href="Output.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="AFrame" rel="Chapter" href="AFrame.html">
<link title="Audio_converter" rel="Chapter" href="Audio_converter.html">
<link title="Clock" rel="Chapter" href="Clock.html">
<link title="Configure" rel="Chapter" href="Configure.html">
<link title="Decoder" rel="Chapter" href="Decoder.html">
<link title="Doc" rel="Chapter" href="Doc.html">
<link title="Dyntools" rel="Chapter" href="Dyntools.html">
<link title="Encoder" rel="Chapter" href="Encoder.html">
<link title="Frame" rel="Chapter" href="Frame.html">
<link title="Generated" rel="Chapter" href="Generated.html">
<link title="Generator" rel="Chapter" href="Generator.html">
<link title="Http" rel="Chapter" href="Http.html">
<link title="IoRing" rel="Chapter" href="IoRing.html">
<link title="JSON" rel="Chapter" href="JSON.html">
<link title="Lang" rel="Chapter" href="Lang.html">
<link title="Lang_types" rel="Chapter" href="Lang_types.html">
<link title="Lang_values" rel="Chapter" href="Lang_values.html">
<link title="MFrame" rel="Chapter" href="MFrame.html">
<link title="Ogg_muxer" rel="Chapter" href="Ogg_muxer.html">
<link title="Output" rel="Chapter" href="Output.html">
<link title="Playlist_parser" rel="Chapter" href="Playlist_parser.html">
<link title="Plug" rel="Chapter" href="Plug.html">
<link title="Request" rel="Chapter" href="Request.html">
<link title="Request_source" rel="Chapter" href="Request_source.html">
<link title="Server" rel="Chapter" href="Server.html">
<link title="Source" rel="Chapter" href="Source.html">
<link title="Switch" rel="Chapter" href="Switch.html">
<link title="Synthesized" rel="Chapter" href="Synthesized.html">
<link title="Tutils" rel="Chapter" href="Tutils.html">
<link title="VFrame" rel="Chapter" href="VFrame.html">
<link title="Video_converter" rel="Chapter" href="Video_converter.html"><link title="Types" rel="Section" href="#2_Types">
<link title="API" rel="Section" href="#2_API">
<link title="Utils" rel="Section" href="#2_Utils">
<title>liquidsoap : Ogg_muxer</title>
</head>
<body>
<div class="navbar"><a class="pre" href="MFrame.html" title="MFrame">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Output.html" title="Output">Next</a>
</div>
<h1>Module <a href="type_Ogg_muxer.html">Ogg_muxer</a></h1>

<pre><span id="MODULEOgg_muxer"><span class="keyword">module</span> Ogg_muxer</span>: <code class="code">sig</code> <a href="Ogg_muxer.html">..</a> <code class="code">end</code></pre><div class="info module top">
<div class="info-desc">
<p>Ogg Stream Encoder</p>
</div>
</div>
<hr width="100%">

<pre><span id="VALlog"><span class="keyword">val</span> log</span> : <code class="type">Dtools.Log.t</code></pre><h3 id="2_Types">Types</h3>
<pre><span id="EXCEPTIONInvalid_data"><span class="keyword">exception</span> Invalid_data</span></pre>

<pre><span id="EXCEPTIONInvalid_usage"><span class="keyword">exception</span> Invalid_usage</span></pre>

<pre><span id="TYPEaudio"><span class="keyword">type</span> <code class="type"></code>audio</span> = <code class="type">float array array</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Audio data type</p>
</div>
</div>


<pre><span id="TYPEvideo"><span class="keyword">type</span> <code class="type"></code>video</span> = <code class="type">Video.buffer</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Video data type</p>
</div>
</div>


<pre><code><span id="TYPEdata"><span class="keyword">type</span> <code class="type">'a</code> data</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.data">data</span>&nbsp;: <code class="type">'a</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.offset">offset</span>&nbsp;: <code class="type">int</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.length">length</span>&nbsp;: <code class="type">int</code>;</code></td>

</tr></table>
}

<div class="info ">
<div class="info-desc">
<p>A data unit</p>
</div>
</div>


<pre><code><span id="TYPEtrack_data"><span class="keyword">type</span> <code class="type"></code>track_data</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtrack_data.Audio_data"><span class="constructor">Audio_data</span></span> <span class="keyword">of</span> <code class="type"><a href="Ogg_muxer.html#TYPEaudio">audio</a> <a href="Ogg_muxer.html#TYPEdata">data</a></code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtrack_data.Video_data"><span class="constructor">Video_data</span></span> <span class="keyword">of</span> <code class="type"><a href="Ogg_muxer.html#TYPEvideo">video</a> <a href="Ogg_muxer.html#TYPEdata">data</a></code></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p>A track data is a data unit of either audio or video.</p>
</div>
</div>


<pre><span id="TYPEtrack_encoder"><span class="keyword">type</span> <code class="type">'a</code> track_encoder</span> = <code class="type">'a <a href="Ogg_muxer.html#TYPEdata">data</a> -> Ogg.Stream.stream -> (Ogg.Page.t -> unit) -> unit</code> </pre>
<div class="info ">
<div class="info-desc">
<p>A track encoder takes the track data,
 the ogg logical stream, and fills the stream.
 If the encoding process outputs ogg pages, then
 the encoder should use the last argument to add its pages
 to the stream.</p>
</div>
</div>


<pre><span id="TYPEheader_encoder"><span class="keyword">type</span> <code class="type"></code>header_encoder</span> = <code class="type">Ogg.Stream.stream -> Ogg.Page.t</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Returns the first page of the stream,
 to be placed at the very beginning.</p>
</div>
</div>


<pre><code><span id="TYPEposition"><span class="keyword">type</span> <code class="type"></code>position</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTposition.Unknown"><span class="constructor">Unknown</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTposition.Time"><span class="constructor">Time</span></span> <span class="keyword">of</span> <code class="type">float</code></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p>Return the end time of a page, in milliseconds.</p>
</div>
</div>


<pre><span id="TYPEpage_end_time"><span class="keyword">type</span> <code class="type"></code>page_end_time</span> = <code class="type">Ogg.Page.t -> <a href="Ogg_muxer.html#TYPEposition">position</a></code> </pre>
<div class="info ">
<div class="info-desc">
<p>Type for a function returning a page's ending time.</p>
</div>
</div>


<pre><span id="TYPEfisbone_packet"><span class="keyword">type</span> <code class="type"></code>fisbone_packet</span> = <code class="type">Ogg.Stream.stream -> Ogg.Stream.packet option</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Returns an optional fisbone packet, which
 will contain the data for this stream to
 put in the ogg skeleton, if enabled in
 the encoder.</p>
</div>
</div>


<pre><span id="TYPEstream_start"><span class="keyword">type</span> <code class="type"></code>stream_start</span> = <code class="type">Ogg.Stream.stream -> Ogg.Page.t list</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Returns the remaining header data, before data encoding starts.</p>
</div>
</div>


<pre><span id="TYPEend_of_stream"><span class="keyword">type</span> <code class="type"></code>end_of_stream</span> = <code class="type">Ogg.Stream.stream -> unit</code> </pre>
<div class="info ">
<div class="info-desc">
<p>Ends the track.</p>
</div>
</div>


<pre><code><span id="TYPEdata_encoder"><span class="keyword">type</span> <code class="type"></code>data_encoder</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata_encoder.Audio_encoder"><span class="constructor">Audio_encoder</span></span> <span class="keyword">of</span> <code class="type"><a href="Ogg_muxer.html#TYPEaudio">audio</a> <a href="Ogg_muxer.html#TYPEtrack_encoder">track_encoder</a></code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata_encoder.Video_encoder"><span class="constructor">Video_encoder</span></span> <span class="keyword">of</span> <code class="type"><a href="Ogg_muxer.html#TYPEvideo">video</a> <a href="Ogg_muxer.html#TYPEtrack_encoder">track_encoder</a></code></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p>A data encoder is an encoder for either a audio or a video track.</p>
</div>
</div>


<pre><code><span id="TYPEstream_encoder"><span class="keyword">type</span> <code class="type"></code>stream_encoder</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.header_encoder">header_encoder</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEheader_encoder">header_encoder</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.fisbone_packet">fisbone_packet</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEfisbone_packet">fisbone_packet</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.stream_start">stream_start</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEstream_start">stream_start</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.data_encoder">data_encoder</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEdata_encoder">data_encoder</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.end_of_page">end_of_page</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEpage_end_time">page_end_time</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstream_encoder.end_of_stream">end_of_stream</span>&nbsp;: <code class="type"><a href="Ogg_muxer.html#TYPEend_of_stream">end_of_stream</a></code>;</code></td>

</tr></table>
}

<div class="info ">
<div class="info-desc">
<p>The full stream encoder type.</p>
</div>
</div>


<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info ">
<div class="info-desc">
<p>Main type for the ogg encoder</p>
</div>
</div>


<pre><code><span id="TYPEstate"><span class="keyword">type</span> <code class="type"></code>state</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstate.Eos"><span class="constructor">Eos</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstate.Streaming"><span class="constructor">Streaming</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstate.Bos"><span class="constructor">Bos</span></span></code></td>

</tr></table>

<div class="info ">
<div class="info-desc">
<p>You may register new tracks on state Eos or Bos.
 You can't register new track on state Streaming.</p>
</div>
</div>

<h3 id="2_API">API</h3><p>Usage:</p>

<p>Encoding:</p>

<ul>
<li><code class="code">create ~skeleton name</code> : create a new encoder</li>
<li><code class="code">register_track encoder stream_encoder</code> : register a new track</li>
<li>ibid</li>
<li>(...)</li>
<li><code class="code">streams_start encoder</code> : start the tracks (optional)</li>
<li><code class="code">encode encoder track_serial track_data</code> : encode data for one track</li>
<li>ibid</li>
<li>(...)</li>
<li>(encode data for other tracks)</li>
<li><code class="code">end_of_track encoder track_serial</code> : ends a track. (track end do not need to be simultaneous)</li>
<li>(...)</li>
<li><code class="code">end_of_stream encoder</code>: ends all tracks as well as the encoder. Set Eos state on the encoder.</li>
<li><code class="code">register_track encoder stream_encoder</code> : register a new track, starts a new sequentialized stream</li>
<li>And so on..</li>
</ul>
<p>You get encoded data by calling <code class="code">get_data</code>, <code class="code">peek_data</code>.</p>

<p>See: http://xiph.org/ogg/doc/oggstream.html for more details on the
 specifications of an ogg stream. This API reflects exactly what is recomended to do.</p>

<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">skeleton:bool -> string -> <a href="Ogg_muxer.html#TYPEt">t</a></code></pre><div class="info ">
<div class="info-desc">
<p>Create a new encoder.
 Add an ogg skeleton if <code class="code">skeleton</code> is <code class="code">true</code>.</p>
</div>
</div>

<pre><span id="VALstate"><span class="keyword">val</span> state</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> <a href="Ogg_muxer.html#TYPEstate">state</a></code></pre><div class="info ">
<div class="info-desc">
<p>Get the state of an encoder.</p>
</div>
</div>

<pre><span id="VALget_data"><span class="keyword">val</span> get_data</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> string</code></pre><div class="info ">
<div class="info-desc">
<p>Get and remove encoded data..</p>
</div>
</div>

<pre><span id="VALget_header"><span class="keyword">val</span> get_header</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> string</code></pre><div class="info ">
<div class="info-desc">
<p>Get header of a stream.</p>
</div>
</div>

<pre><span id="VALpeek_data"><span class="keyword">val</span> peek_data</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> string</code></pre><div class="info ">
<div class="info-desc">
<p>Peek encoded data without removing it.</p>
</div>
</div>

<pre><span id="VALregister_track"><span class="keyword">val</span> register_track</span> : <code class="type">?fill:int -> <a href="Ogg_muxer.html#TYPEt">t</a> -> <a href="Ogg_muxer.html#TYPEstream_encoder">stream_encoder</a> -> nativeint</code></pre><div class="info ">
<div class="info-desc">
<p>Register a new track to the stream.
 The state needs to be <code class="code">Bos</code> or <code class="code">Eos</code>.</p>

<p><code class="code">fill</code> parameter is used to try to control ogg
 logical page's size. See <code class="code">Ogg.get_page</code> for more
 details.</p>

<p>Returns the serial number of the registered ogg
 stream.</p>
</div>
</div>

<pre><span id="VALstreams_start"><span class="keyword">val</span> streams_start</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> unit</code></pre><div class="info ">
<div class="info-desc">
<p>Start streams, set state to <code class="code">Streaming</code>.</p>
</div>
</div>

<pre><span id="VALencode"><span class="keyword">val</span> encode</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> nativeint -> <a href="Ogg_muxer.html#TYPEtrack_data">track_data</a> -> unit</code></pre><div class="info ">
<div class="info-desc">
<p>Encode data. Implicitely calls <code class="code">streams_start</code>
 if not called before. Fails if state is not <code class="code">Streaming</code></p>
</div>
</div>

<pre><span id="VALend_of_track"><span class="keyword">val</span> end_of_track</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> nativeint -> unit</code></pre><div class="info ">
<div class="info-desc">
<p>Finish a track. Raises <code class="code">Not_found</code> if
 no such track exists.</p>
</div>
</div>

<pre><span id="VALend_of_stream"><span class="keyword">val</span> end_of_stream</span> : <code class="type"><a href="Ogg_muxer.html#TYPEt">t</a> -> unit</code></pre><div class="info ">
<div class="info-desc">
<p>Ends all tracks, flush remaining encoded data.
 Set state to <code class="code">Eos</code>.</p>
</div>
</div>
<h3 id="2_Utils">Utils</h3>
<pre><span id="VALflush_pages"><span class="keyword">val</span> flush_pages</span> : <code class="type">Ogg.Stream.stream -> Ogg.Page.t list</code></pre><div class="info ">
<div class="info-desc">
<p>flush all availables pages from an ogg stream</p>
</div>
</div>
</body></html>